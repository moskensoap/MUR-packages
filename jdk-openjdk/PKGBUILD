# Maintainer: moskensoap <141073988+moskensoap@users.noreply.github.com>

pkgname="mur__jdk-openjdk"
pkgver=22
pkgrel=1
pkgdesc='OpenJDK Java development kit'
arch=('any')
url='https://openjdk.org'
license=(GPL2)
makedepends=("gcc"
             "make")
magicnumber=830ec9fcccef480bb3e73fb7ecafe059
buildnumber=36
source=("https://download.java.net/java/GA/jdk${pkgver}/${magicnumber}/${buildnumber}/GPL/openjdk-${pkgver}_windows-x64_bin.zip"
        "main.c"
        "makefile"
        "link.c"
        "linkmakefile"
        "setversion-jdk.c")
sha256sums=('8f5138fecb53c08c20abd4fa6812f9400051f3852582a2142ffda0dff73a5824'
            '15aaee4a2b88c81b3041405583b48f2eb57e8dc9c967e5c8e6f07c2fff6cb1d5'
            'e45cdbda7a078597075fb0a9e1dbe3762a3313c73cbc81d34024a61320a81a50'
            '05cacc627611199b66ea56d945d46009902a5571426b333b7d6647d58a8e0477'
            '490009190e4fdb5f11e5c716966fc26c96fcb69eb23e594c123ba28f03e4b4a6'
            '1d30ecabcecb9641cbd3fdfb7ca98e0abbd4b48019ac385600924fc1c40d10f9')

prepare() {
  cd ${srcdir}
  for file in $(ls jdk-$pkgver/bin | grep .exe | sed 's/\.exe$/.c/'); do
    cp main.c $file
  done
  rm main.c

  mkdir linker
  cp link.c linker/link.c
  cp linkmakefile linker/makefile
  rm link.c linkmakefile

  cd linker
  for file in $(ls ../jdk-$pkgver/bin | grep .exe | sed 's/\.exe$/.c/'); do
    cp link.c $file
  done
  rm link.c

  cd ..
  mkdir setversion
  cp setversion-jdk.c setversion/setversion-jdk.c
  rm setversion-jdk.c
}

build() {
  cd ${srcdir}
  make
  cd linker
  make
  cd ../setversion
  gcc -o setversion-jdk setversion-jdk.c
}

package() {
  cd ${srcdir}
  mkdir -p ${pkgdir}/opt/bin/
  install -Dm755 ./*.exe ${pkgdir}/opt/bin/
  install -Dm755 linker/*.exe ${pkgdir}/opt/bin/
  install -Dm755 setversion/setversion-jdk.exe ${pkgdir}/opt/bin/
  mkdir -p ${pkgdir}/opt/share/java/${pkgname}/
  cp -a jdk-$pkgver/* ${pkgdir}/opt/share/java/${pkgname}/
}